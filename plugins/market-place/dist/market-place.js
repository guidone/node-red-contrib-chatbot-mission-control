define(["../../src/components","code-plug","graphql-tag","lodash","react","react-apollo","rsuite","use-http"],(e,t,n,o,r,a,i,l)=>(()=>{var s={631:(e,t,n)=>{"use strict";n.r(t);var o=n(297),r=n.n(o),a=n(399),i=n(186),l=n(222),s=n(74),c=n(875),u=n.n(c),p=n(939),d=n.n(p),m=n(804),g=n.n(m);function f(){}const y=function(e,t){var n,o=0,r=1,a={},i=(t=t||{}).maxAttempts||1/0;return a.open=function(){(n=new WebSocket(e,t.protocols||[])).onmessage=t.onmessage||f,n.onopen=function(e){(t.onopen||f)(e),o=0},n.onclose=function(e){1e3===e.code||1001===e.code||1005===e.code||a.reconnect(e),(t.onclose||f)(e)},n.onerror=function(e){e&&"ECONNREFUSED"===e.code?a.reconnect(e):(t.onerror||f)(e)}},a.reconnect=function(e){r&&o++<i?r=setTimeout((function(){(t.onreconnect||f)(e),a.open()}),t.timeout||1e3):(t.onmaximum||f)(e)},a.json=function(e){n.send(JSON.stringify(e))},a.send=function(e){n.send(e)},a.close=function(e,t){r=clearTimeout(r),n.close(e||1e3,t)},a.open(),a},h=new function({url:e,maxAttempts:t=10,timeout:n=5e3}){let o={};const r=(e,...t)=>{null!=o[e]&&o[e].forEach(e=>e(...t))},a=new y(e,{timeout:n,maxAttempts:t,onmessage:e=>{let t;try{t=JSON.parse(e.data)}catch(e){}r("message",t.topic,t.payload)},onreconnect:e=>r("reconnect"),onclose:e=>r("close"),onopen:e=>r("open")}),i={on:(e,t)=>(null==o[e]&&(o[e]=[]),o[e].push(t),i),off:(e,t)=>(null!=o[e]&&(o[e]=o[e].filter(e=>e!==t)),i),close:()=>(o={},a.close(),i),send:e=>(a.send(e),i)};return i}({url:"ws://localhost:"+n(719).wsPort}),b=({reducer:e=(()=>{}),initialState:t={},onMessage:n=(()=>{})}={})=>{const r=(e,t)=>{i({type:"socket.message",topic:e,payload:t}),n(e,t)};(0,o.useEffect)(()=>(h.on("message",r),()=>h.off("message",r)),[]);const[a,i]=(0,o.useReducer)(e,t);return{state:a,dispatch:i,sendMessage:(e,t)=>h.send(JSON.stringify({topic:e,payload:t}))}},k=u()`
query($namespace: String) {
  configurations(namespace: $namespace) {
    id
    namespace
    payload
  }
}
`,v=u()`
mutation($configuration: NewConfiguration!) {
  createConfiguration(configuration: $configuration) {
    id,
    namespace,
    payload
  }
}
`,C=({namespace:e,onCompleted:t=(()=>{}),onLoaded:n=(()=>{})})=>{const{loading:o,error:r,data:a}=(0,s.useQuery)(k,{variables:{namespace:e},onCompleted:e=>{let t;null!=e&&null!=e.configurations&&0!==e.configurations.length&&(t=JSON.parse(e.configurations[0].payload)),n(t)}}),{sendMessage:i}=b();let l;null!=a&&null!=a.configurations&&0!==a.configurations.length&&(l=JSON.parse(a.configurations[0].payload));const[c,{loading:u,error:p}]=(0,s.useMutation)(v,{onCompleted:t});return{loading:o,saving:u,error:r||p,data:l,update:t=>{c({variables:{configuration:{namespace:e,payload:JSON.stringify(t)}}}),i("mc.configuration",{namespace:e,...t})}}},E=u()`
query {
  contents(namespace: "plugins") {
    id,
    title,
    body,
    fields {
      name,
      value
    }
  }
}
`,S=()=>{const e=(0,s.useApolloClient)(),{data:t}=C({namespace:"market-place"}),[n,a]=(0,o.useState)(null),{put:i}=d()("https://api.jsonbin.io",{headers:{"Content-Type":"application/json","secret-key":null!=t?t.jsonbin_key:null,versioning:"false"}}),c=null!=t&&!g().isEmpty(t.jsonbin_key);return r().createElement(l.Button,{disabled:null!=n||!c,appearance:"primary",onClick:async()=>{a("Loading...");const n=(await e.query({query:E,fetchPolicy:"network-only"})).data.contents.map(e=>{const t=e.fields.reduce((e,t)=>({...e,[t.name]:t.value}),{});return{id:t.id,name:e.title,description:e.body,url:t.url,flow:t.flow,version:t.version,github:t.github,author:{name:t.author,url:t.author_url}}});a("Publishing..."),await i("/b/"+t.jsonbin_id,n),a(null),l.Notification.success({title:"Published",description:"Plugin list published succesfully "})}},null!=n?n:"Publish plugins")};(0,a.plug)("sidebar",null,{id:"market-place",label:"Market Place",url:"/market-place",icon:"file-text"}),(0,a.plug)("sidebar",null,{id:"configuration",label:"Configuration",permission:"configure",icon:"cog",options:[{id:"configuration-market-place",label:"Market Place",url:"/configuration-market-place"}]}),(0,a.plug)("pages",(0,i.withConfigurationPage)("market-place",({value:e,onSubmit:t=(()=>{}),disabled:n=!1})=>{const[a,i]=(0,o.useState)(e),[s,c]=(0,o.useState)(null),u=(0,o.useRef)(null);return r().createElement("div",null,r().createElement(l.Form,{formValue:a,formError:s,ref:u,checkTrigger:"none",layout:"vertical",fluid:!0,onChange:e=>{i(e),c(null)},onCheck:e=>{c(e)}},r().createElement(l.FormGroup,null,r().createElement(l.ControlLabel,null,"JSONbin.io id"),r().createElement(l.FormControl,{name:"jsonbin_id",accepter:l.Input,disabled:n}),r().createElement(l.HelpBlock,null,"tbd")),r().createElement(l.FormGroup,null,r().createElement(l.ControlLabel,null,"JSONbin.io key"),r().createElement(l.FormControl,{name:"jsonbin_key",accepter:l.Input,disabled:n}),r().createElement(l.HelpBlock,null,"tbd")),r().createElement(l.FormGroup,{style:{marginTop:"40px"}},r().createElement(l.ButtonToolbar,null,r().createElement(l.Button,{disabled:n,appearance:"primary",onClick:()=>{u.current.check()&&t(a)}},"Save configuration"),r().createElement(l.Button,{disabled:n,appearance:"default",onClick:()=>{confirm("Reset configuration?")&&i(e)}},"Reset")))))},{Legend:()=>r().createElement("div",null,"something here"),title:"Market Place"}),{permission:"configure",url:"/configuration-market-place",title:"Market Place",id:"configuration"}),(0,a.plug)("pages",i.Content.Contents,{url:"/market-place",title:"Market Place",id:"market-place",namespace:"plugins",breadcrumbs:["Market Place","Plugins"],labels:{saveContent:"Save plugin",createContent:"Create plugin",emptyContent:"No plugins"},custom:()=>r().createElement(S,null),customFieldsSchema:[{key:"url",type:"string",description:"URL of the compiled plugin",color:"cyan"},{key:"flow",type:"string",description:"URL of the Node-RED flow for this plugin",color:"cyan"},{key:"id",type:"string",description:"Unique id of the plugin",color:"red"},{key:"version",type:"string",description:"The version of the current (latest) plugin",color:"red"},{key:"github",type:"string",description:"The URL of the github page of the plugin",color:"red"},{key:"author",type:"string",description:"The username of the author of the plugin",color:"orange"},{key:"author_url",type:"string",description:"The home page of the username, if any",color:"orange"}]})},719:e=>{e.exports={wsPort:1942,notificationPort:1943}},186:t=>{"use strict";t.exports=e},399:e=>{"use strict";e.exports=t},875:e=>{"use strict";e.exports=n},804:e=>{"use strict";e.exports=o},297:e=>{"use strict";e.exports=r},74:e=>{"use strict";e.exports=a},222:e=>{"use strict";e.exports=i},939:e=>{"use strict";e.exports=l}},c={};function u(e){if(c[e])return c[e].exports;var t=c[e]={exports:{}};return s[e](t,t.exports,u),t.exports}return u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u(631)})());